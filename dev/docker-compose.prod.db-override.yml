# Docker Compose database override - Adds database to production and testing services

services:
  #################################################################
  ## PRODUCTION WITH DATABASE
  #################################################################
  prod:
    env_file:
      # Inherit docker.env from base
      - path: ../docker.env
        required: true
      # Inherit app.env from base
      - path: ../app.env
        required: false
      # Add database configuration (higher priority)
      - path: db.local.env
        required: true
    depends_on:
      - db

  #################################################################
  ## TESTING WITH DATABASE
  #################################################################
  testing:
    env_file:
      # Inherit docker.env from base
      - path: ../docker.env
        required: true
      # Inherit app.env from base
      - path: ../app.env
        required: false
      # Add database configuration (higher priority)
      - path: db.local.env
        required: true
    depends_on:
      - db

  #################################################################
  ## DATABASE
  #################################################################
  db:
    image: mysql:8.4
    env_file:
      - path: db.local.env
        required: true
    ports:
      - "3306:3306"

#################################################################
## USAGE GUIDE
#################################################################
#
# Run commands with database:
#   Production with DB:   docker compose -f docker-compose.yml -f dev/docker-compose.prod.db-override.yml up --build prod
#   Testing with DB:      docker compose -f docker-compose.yml -f dev/docker-compose.prod.db-override.yml run --build --rm testing
#
# Configuration Files:
#   dev/db.local.env            - Database settings (optional, ignored by git)
#
# Environment File Priority (later files override earlier ones):
#   1. docker.env (Docker build variables)
#   2. app.env (base application settings)
#   3. dev/db.local.env (database settings, highest priority)
